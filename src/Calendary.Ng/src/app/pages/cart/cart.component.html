<section class="cart-page">
  <header class="cart-page__header">
    <div>
      <p class="cart-page__eyebrow">Етап 1 з 2</p>
      <h1>Кошик</h1>
      <p class="cart-page__subtitle">Перевірте вибрані календарі перед оформленням доставки.</p>
    </div>
    <button type="button" class="cart-page__refresh" (click)="refreshCart()" [disabled]="isLoading">
      Оновити
    </button>
  </header>

  <div *ngIf="loadError" class="cart-page__error">
    <p>{{ loadError }}</p>
  </div>

  <ng-container *ngIf="!isLoading; else loadingState">
    <app-empty-cart *ngIf="!hasItems()" actionLabel="Перейти до каталогу" actionLink="/catalog"></app-empty-cart>

    <div *ngIf="hasItems()" class="cart-layout">
      <div class="cart-items">
        <app-cart-item
          *ngFor="let item of order?.items; trackBy: trackByItem"
          [item]="item"
          [disabled]="updatingItemId === item.id || removingItemId === item.id"
          (quantityChange)="onQuantityChange(item, $event)"
          (remove)="onRemoveItem(item)"
          (preview)="openPreview($event)"
        ></app-cart-item>

        <section class="cart-comment">
          <label for="orderComment">Коментар до замовлення</label>
          <textarea
            id="orderComment"
            rows="4"
            [(ngModel)]="commentValue"
            (blur)="onCommentChange()"
            placeholder="Додайте уточнення або побажання"
          ></textarea>
        </section>
      </div>

      <app-cart-summary
        [totalItems]="totalItems"
        [subtotal]="subtotal"
        [isLoading]="isLoading"
        (checkout)="goToCheckout()"
        (continueShopping)="continueShopping()"
      ></app-cart-summary>
    </div>
  </ng-container>

  <ng-template #loadingState>
    <div class="cart-page__loading">Завантаження кошика...</div>
  </ng-template>

  <div class="modal" *ngIf="previewImage">
    <div class="modal-overlay" (click)="closePreview()"></div>
    <img [src]="previewImage" class="modal-image" />
  </div>
</section>
